<html>
  <style type='text/css'>
    html {
      background-color: #444;
    }

    #terminal {
      width: 80%;
      margin: 2rem auto;
      background-color: #000;
      padding: 0.5rem 1rem;
      height: 80%;
      overflow: scroll;
    }

    .unit {
      width: 90%;
      margin: 0.5rem auto;
      padding: 0.5rem 1rem;
      color: #ddd;
      background-color: #000;
      border: 1px  solid #040;
      font-family: monospace;
    }

    .unit.error {
      color: #f88;
    }

    #command-line {
      display: block;
      width: 80%;
      margin: 1rem auto;
      padding: 0.5rem;
      color: #ddd;
      background-color: #000;
      font-family: monospace;
    }

    #prompt {
      color: #0d0;
      font-size: 150%;
    }

    #cli {
      width: 95%;
      color: #ddd;
      background-color: #000;
      border: none;
      outline: none;
      font-size: 150%;
    }

    #cli:focus {
      border: none;
      outline: none;
      color: #ddd;
      font-family: monospace;
    }
  </style>

  <div id='terminal'>
    <div class='unit'>
      This is a terminal unit.
    </div>
  </div>

  <div id='command-line'>
    <span id='prompt'>$</span>
    <input id='cli' />
  </div>

  <script type='text/javascript'>
    const cli = document.getElementById('cli');
    console.log(cli);

    const commandant = {
      marshal: function (str) {
        const [ arg0, rest ] = str.split(/\s+/, 2);

        return { arg0, rest };
      },
    };

    const actor = {
      unknown: function (command) {
        return {
          class: "error",
          text : `Command ${command.arg0} is unknown.`,
        }
      },
      execute: function (command) {
        const handler = this.commands[command.arg0];

        if (! handler) return this.unknown(command);

        return handler(command);
      },
      commands: {
        help: function (command) {
          return {
            text: "Known commands: echo, help",
          };
        },
        echo: function (command) {
          return {
            text: `ECHO: ${command.rest}`,
          }
        },
      },
    };

    cli.addEventListener('keyup', (event) => {
      if (event.code !== 'Enter') return;

      const text = cli.value;

      if (text.length === 0) return;

      cli.value = "";

      const command = commandant.marshal(text);

      console.log("command: ", command);

      const result = actor.execute(command);

      const output = document.createElement('div');
      output.classList.add('unit');
      if (result.class) output.classList.add(result.class);

      output.appendChild( document.createTextNode(result.text));

      const terminal = document.getElementById('terminal');
      terminal.appendChild(output);
    });
  </script>
</html>
